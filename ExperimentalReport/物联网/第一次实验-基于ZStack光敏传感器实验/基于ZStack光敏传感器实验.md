
基于ZStack光敏传感器实验


# 实验目的

通过上位机发指令给协调器，协调器把串口接收到的指令通过Zigbee协议无线传送给带有光敏传感器的终端节点，获取到数据后把数据返回给上位机，实现无线获取数据的目的。

# 实验步骤

## 硬件前期准备

首先要准备一定的 Zigbee 节点以及配套所要使用的JLink和CCDebugger仿真器，指定其中一个节点作为实验中的网关（协调器），其他的节点则为对应的终端机。每个节点的主要构成为一个STM32的底板，搭载一个光敏传感器芯片、一个用于无线传输的芯片。上位机指的就是串口连接网关的设备（计算机）。

## 实验具体过程

实验过程主要分为两步：终端机的传感器的配置以及网关和终端间的通信协议ZStack的配置。通信硬件为 CC2530 。

+ 硬件配置完成后，打开 ``./RVMDK/Test.uvproj`` 工程，并编译，然后将 JLink 下载器插到 **终端** 节点上，然后下载烧录。
+ 此时可以通过 **串口** 来查看终端节点的光敏传感器是否工作正常：使用串口线将上位机和终端的串口连接，将右下角的白色三档开关拨至左边，正确配置串口助手，然后配置地址： ``FF 30 00 08 00 C1`` ，发送后会收到相同的指令，表示配置成功，此时无误后便可获取传感器的数据，发送指令： ``08 03 00 2A 00 01 a5 5b`` ，然后会收到传感器返回的数据，其中第4、5位字节即为光敏的AD数值。
+ 在配置好终端传感器后，便可进行对网关、终端间无线通信的配置。
+ 打开 ``./ZStack-CC2530/Projects/zstack/Samples/GenericApp/CC2530DB/GenericApp.eww`` 项目（尽量避免文件路径含有中文以及过深），项目中包含三个工程，网关 ``CoordinatorEB`` 、路由 ``RouteEB`` 以及终端 ``EndDeviceEB`` ，然后要配置一个特定的 **PANID** ，因为实验室中可能有很多人在实验，相同的ID会影响本网关于终端间的通信，修改 ``Tools/f8wConfig.cfg`` 中的 ``-DZDAPP_CONGIG_PAN_ID=0xFF99`` 即可。
+ 然后编译网关的代码，并CCDebugger插到网关上，并保证指示灯为绿色，然后下载烧录。
+ 然后编译终端代码，同上操作即可。
+ 之后验证是否建立通信：将 **终端** 的三档白色开关拨至中间（STM32和CC2630芯片间串口通信），然后网关、终端都断电复位一次，串口线连接网关（协调器），网关的开关拨至右边
+ 打开串口助手，配置参数，然后发送指令： ``08 03 00 2A 00 01 a5 ab`` ，此时会接收到从终端的光敏芯片采集到的数据（第4、5字节），如单独在终端进行串口调试一样。
+ 无误表示实验成功，实现实验的目的。